# Vulnerability Management Guide

Comprehensive guide to vulnerability severity classification, triage, and management.

## Vulnerability Severity Levels

```
┌─────────────────────────────────────────────────────────────────────┐
│                    VULNERABILITY SEVERITY LEVELS                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  CRITICAL (CVSS 9.0-10.0)                                           │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ Impact: Complete system compromise possible                   │  │
│  │ Examples:                                                     │  │
│  │   • Remote code execution (RCE)                               │  │
│  │   • SQL injection with admin access                           │  │
│  │   • Authentication bypass                                     │  │
│  │   • Hardcoded admin credentials                               │  │
│  │                                                               │  │
│  │ Priority: Highest - blocks deployment                         │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  HIGH (CVSS 7.0-8.9)                                                │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ Impact: Significant data breach or system access possible     │  │
│  │ Examples:                                                     │  │
│  │   • XSS that can steal session cookies                        │  │
│  │   • IDOR exposing PII                                         │  │
│  │   • Privilege escalation                                      │  │
│  │   • Weak encryption of sensitive data                         │  │
│  │                                                               │  │
│  │ Priority: High - should block PR merge                        │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  MEDIUM (CVSS 4.0-6.9)                                              │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ Impact: Limited data exposure or functionality abuse          │  │
│  │ Examples:                                                     │  │
│  │   • Reflected XSS (requires user interaction)                 │  │
│  │   • CSRF on non-sensitive actions                             │  │
│  │   • Information disclosure (non-PII)                          │  │
│  │   • Missing security headers                                  │  │
│  │                                                               │  │
│  │ Priority: Medium - warning, tracked for remediation           │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  LOW (CVSS 0.1-3.9)                                                 │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ Impact: Minimal impact, defense-in-depth                      │  │
│  │ Examples:                                                     │  │
│  │   • Version disclosure in headers                             │  │
│  │   • Missing X-Content-Type-Options                            │  │
│  │   • Verbose error messages (no sensitive data)                │  │
│  │                                                               │  │
│  │ Priority: Low - informational, best practice                  │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## CVSS (Common Vulnerability Scoring System)

### CVSS v3.1 Metrics

**Base Metrics**:
1. **Attack Vector (AV)**
   - Network (N): Remotely exploitable
   - Adjacent (A): Adjacent network required
   - Local (L): Local access required
   - Physical (P): Physical access required

2. **Attack Complexity (AC)**
   - Low (L): No special conditions
   - High (H): Special conditions required

3. **Privileges Required (PR)**
   - None (N): No authentication
   - Low (L): Basic user privileges
   - High (H): Admin privileges required

4. **User Interaction (UI)**
   - None (N): No user interaction
   - Required (R): User must take action

5. **Scope (S)**
   - Unchanged (U): Impact limited to vulnerable component
   - Changed (C): Impact extends beyond vulnerable component

6. **Impact Metrics**
   - Confidentiality (C): None, Low, High
   - Integrity (I): None, Low, High
   - Availability (A): None, Low, High

**CVSS String Example**:
```
CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
```
Score: 10.0 (Critical)

### CVSS Calculation Examples

**Critical Vulnerability Example**:
```
Vulnerability: Unauthenticated Remote Code Execution
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
Base Score: 10.0 (Critical)

Breakdown:
- Attack Vector: Network (remotely exploitable)
- Attack Complexity: Low (no special conditions)
- Privileges Required: None (unauthenticated)
- User Interaction: None (automatic exploitation)
- Scope: Changed (affects other components)
- Confidentiality: High (full data disclosure)
- Integrity: High (full data modification)
- Availability: High (complete DoS possible)
```

**High Vulnerability Example**:
```
Vulnerability: Stored XSS in Admin Panel
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N
Base Score: 7.6 (High)

Breakdown:
- Attack Vector: Network
- Attack Complexity: Low
- Privileges Required: High (admin account needed)
- User Interaction: Required (victim must visit page)
- Scope: Changed
- Confidentiality: High (session hijacking)
- Integrity: High (can modify data)
- Availability: None
```

**Medium Vulnerability Example**:
```
Vulnerability: Missing Rate Limiting
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
Base Score: 5.3 (Medium)

Breakdown:
- Attack Vector: Network
- Attack Complexity: Low
- Privileges Required: None
- User Interaction: None
- Scope: Unchanged
- Confidentiality: None
- Integrity: None
- Availability: Low (resource exhaustion possible)
```

## Vulnerability Triage Process

### Triage Workflow

```
1. Initial Assessment
   ↓
2. Validation (Is it a real vulnerability?)
   ↓
3. Severity Classification (CVSS scoring)
   ↓
4. Impact Analysis (Affected systems, data)
   ↓
5. Exploitability Assessment (PoC available?)
   ↓
6. Prioritization (Business context)
   ↓
7. Assignment (Dev team, security team)
   ↓
8. Tracking (Ticket created, SLA set)
```

### Validation Checklist

**Is it a real vulnerability?**
- [ ] Verified in current version
- [ ] Reproducible with proof-of-concept
- [ ] Not a false positive from scanner
- [ ] Not mitigated by existing controls
- [ ] Affects production configuration
- [ ] Not a duplicate of existing issue

**False Positive Examples**:
```
# False Positive: Theoretical SQL injection that uses parameterized queries
Scanner: "Potential SQL injection in user_id parameter"
Reality: user_id = db.execute("SELECT * FROM users WHERE id = ?", [user_id])
Verdict: False positive - parameterized query prevents injection

# False Positive: XSS in JSON API that doesn't render HTML
Scanner: "XSS vulnerability in /api/data endpoint"
Reality: Endpoint returns JSON (Content-Type: application/json), not HTML
Verdict: False positive - no HTML rendering context
```

### Impact Analysis

**Questions to Answer**:
1. What data is at risk? (PII, PHI, financial, credentials)
2. How many users are affected? (all, subset, admins only)
3. What systems are affected? (production, staging, dev)
4. Is there compensating control? (WAF, network segmentation)
5. What is the exploitability? (public exploit, requires auth)

**Impact Assessment Matrix**:
```
┌─────────────────────────────────────────────────────────────────┐
│                    Impact vs Likelihood                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│              Low          Medium         High                   │
│           Likelihood    Likelihood    Likelihood                │
│                                                                 │
│  High       ┌─────────┬─────────┬─────────┐                    │
│  Impact     │ Medium  │  High   │Critical │                    │
│             ├─────────┼─────────┼─────────┤                    │
│  Medium     │  Low    │ Medium  │  High   │                    │
│  Impact     ├─────────┼─────────┼─────────┤                    │
│  Low        │  Low    │  Low    │ Medium  │                    │
│  Impact     └─────────┴─────────┴─────────┘                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Remediation Priority

### SLA by Severity

**Recommended Remediation SLAs**:
```
Critical: 24-48 hours
- Emergency patch or hotfix
- All hands on deck
- Immediate communication to stakeholders

High: 7 days
- Scheduled patch release
- Include in next sprint
- Regular stakeholder updates

Medium: 30 days
- Include in backlog
- Prioritize in upcoming release
- Track progress

Low: 90 days or next major release
- Address during refactoring
- Include in technical debt cleanup
- Document workaround if any
```

### Exceptions and Risk Acceptance

**When to Accept Risk**:
1. Compensating controls exist (e.g., WAF blocks exploit)
2. Affected functionality not used
3. Exploitation requires high privileges
4. Fix would break critical functionality
5. System to be decommissioned soon

**Exception Request Template**:
```markdown
## Vulnerability Exception Request

**Vulnerability ID**: CVE-2023-12345
**Severity**: High (CVSS 8.1)
**Affected System**: Legacy API v1

**Justification for Exception**:
- System behind WAF that blocks this attack vector
- Only accessible to authenticated admin users
- System scheduled for decommissioning in 60 days
- Fix requires complete rewrite not feasible in timeline

**Compensating Controls**:
1. WAF rule blocks exploit attempts
2. Additional authentication required
3. Enhanced logging and monitoring
4. Network segmentation

**Risk Owner**: John Doe (VP Engineering)
**Expiration Date**: 2024-03-01
**Review Date**: Monthly

**Approval**: [Signature] [Date]
```

## Tracking and Metrics

### Key Metrics

**Vulnerability Metrics**:
1. **Total Open Vulnerabilities**: Count by severity
2. **Mean Time to Detect (MTTD)**: Time from introduction to detection
3. **Mean Time to Remediate (MTTR)**: Time from detection to fix
4. **SLA Compliance**: % of vulnerabilities fixed within SLA
5. **Vulnerability Density**: Vulnerabilities per 1000 lines of code
6. **Recurrence Rate**: % of vulnerabilities that reappear

**Example Tracking Dashboard**:
```
┌─────────────────────────────────────────────────────────────────┐
│              Vulnerability Tracking Dashboard                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Open Vulnerabilities by Severity:                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Critical: ███ 3                                          │   │
│  │ High:     ████████ 15                                    │   │
│  │ Medium:   ████████████████ 32                            │   │
│  │ Low:      ████████████████████████ 48                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Mean Time to Remediate (MTTR):                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Critical: 2.1 days  (Target: 2 days)  ✓                  │   │
│  │ High:     8.5 days  (Target: 7 days)  ✗                  │   │
│  │ Medium:   28 days   (Target: 30 days) ✓                  │   │
│  │ Low:      75 days   (Target: 90 days) ✓                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  SLA Compliance: 87% (Target: 95%)                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Vulnerability Tracking Template

**Ticket Fields**:
```yaml
Vulnerability Ticket:
  ID: VULN-2024-001
  Title: "SQL Injection in User Search Endpoint"
  Severity: High
  CVSS Score: 8.1
  CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N

  Discovery:
    Found By: SAST Tool (Semgrep)
    Date Detected: 2024-01-15
    Scanner Rule: "sql-injection-concatenation"

  Affected:
    Component: User Service API
    File: src/api/users.py
    Line: 145
    Endpoints:
      - GET /api/users/search

  Description: |
    The user search endpoint constructs SQL queries using string
    concatenation instead of parameterized queries, allowing SQL
    injection attacks.

  Impact:
    - Unauthorized data access
    - Potential data modification
    - PII exposure risk

  Proof of Concept: |
    GET /api/users/search?name=admin' OR '1'='1' --

  Remediation:
    Recommendation: "Use parameterized queries"
    Assigned To: Jane Developer
    Due Date: 2024-01-22 (7 days)
    Fix PR: #1234

  Validation:
    Retest Date: 2024-01-23
    Verified By: Security Team
    Status: Closed
```

## Remediation Verification

### Verification Checklist

**After Fix Applied**:
- [ ] Original vulnerability no longer reproducible
- [ ] Proof-of-concept exploit fails
- [ ] Security scanner no longer flags issue
- [ ] Similar patterns checked in codebase
- [ ] Unit test added to prevent regression
- [ ] Security documentation updated
- [ ] Change reviewed by security team

**Regression Testing**:
```python
def test_sql_injection_fixed():
    """Regression test for VULN-2024-001"""
    session = login("testuser", "password")

    # Test original exploit
    response = session.get("/api/users/search", params={
        "name": "admin' OR '1'='1' --"
    })

    # Should be sanitized now
    assert response.status_code == 200
    data = response.json()

    # Should not return all users
    assert len(data["users"]) < 10

    # Should only return users matching literal string
    for user in data["users"]:
        assert "admin' OR" in user["name"].lower()
```

## Vulnerability Disclosure

### Internal Disclosure

**Communication Plan**:
1. **Immediate (Critical)**: Security team, engineering leads, CTO
2. **24 hours**: Development teams, DevOps, QA
3. **After fix**: All engineering, compliance team
4. **Post-incident**: Company-wide (if customer-impacting)

**Disclosure Template**:
```markdown
## Security Vulnerability Alert

**Severity**: Critical
**Status**: Fixed in production

**Summary**:
A critical SQL injection vulnerability was discovered in the user
search endpoint that could allow unauthorized data access.

**Timeline**:
- 2024-01-15 10:00 - Vulnerability discovered
- 2024-01-15 12:00 - Security team alerted
- 2024-01-15 14:00 - Fix developed and tested
- 2024-01-15 16:00 - Fix deployed to production
- 2024-01-16 09:00 - Verification complete

**Impact**:
- No evidence of exploitation
- No data breach detected
- Affected endpoint accessed by 5 users during window

**Remediation**:
- SQL queries now use parameterized statements
- Input validation added
- Security test added to CI/CD

**Next Steps**:
- Code review of similar patterns
- Developer training on secure coding
- Enhanced monitoring deployed
```

### External Disclosure (CVE)

**When to File CVE**:
- Vulnerability affects open-source project
- Publicly distributed software
- Third-party vendor product
- Regulatory requirement

**CVE Request Process**:
1. Request CVE ID from CNA (CVE Numbering Authority)
2. Coordinate disclosure date with vendor
3. Prepare security advisory
4. Notify affected parties
5. Publish advisory on disclosure date

## Best Practices Summary

1. **Automate Scanning**
   - Integrate SAST, SCA, DAST in CI/CD
   - Run scans on every commit/PR
   - Regular scheduled scans

2. **Prioritize Wisely**
   - Use CVSS as baseline, adjust for context
   - Consider exploitability and business impact
   - Focus on critical/high first

3. **Track Everything**
   - Centralized vulnerability management system
   - Track from detection to remediation
   - Measure MTTR and SLA compliance

4. **Prevent Recurrence**
   - Add regression tests
   - Update coding standards
   - Developer training
   - Enhanced code review

5. **Communicate Clearly**
   - Timely notification to stakeholders
   - Clear impact and timeline
   - Regular status updates
   - Post-incident review
